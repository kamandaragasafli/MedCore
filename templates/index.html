{% extends 'base.html' %}
{% block title %}MedAdmin - Dashboard{% endblock %}

{% block active_dashboard %}active{% endblock %}

{% block content %}
<div class="page-header">
    <div>
        <div class="page-eyebrow">Dashboard</div>
        <h1>Salam {{ user.username }} ðŸ‘‹</h1>
        <p>Track patient visits, appointments and regional insights at a glance.</p>
    </div>
    <div class="header-actions">
        <button class="ghost-btn">Share</button>
        <button class="primary-btn">Book Appointment</button>
    </div>
</div>

<div class="stats-grid">
    <div class="stat-card">
        <div class="label">
            <span>Total Appointment</span>
            <span class="trend" id="trend-appointment">+25% 25 days</span>
        </div>
        <div class="value" id="value-appointment">7,365</div>
        <div class="sparkline">
            <canvas id="sparkline-appointment"></canvas>
        </div>
    </div>
    <div class="stat-card">
        <div class="label">
            <span>Total Patient</span>
            <span class="trend" id="trend-patient">+15% 30 days</span>
        </div>
        <div class="value" id="value-patient">5,656</div>
        <div class="sparkline">
            <canvas id="sparkline-patient"></canvas>
        </div>
    </div>
    <div class="stat-card">
        <div class="label">
            <span>Total Vacancy</span>
            <span class="trend negative" id="trend-vacancy">-5% 30 days</span>
        </div>
        <div class="value" id="value-vacancy">636</div>
        <div class="sparkline">
            <canvas id="sparkline-vacancy"></canvas>
        </div>
    </div>
    <div class="stat-card">
        <div class="label">
            <span>Total Doctors</span>
            <span class="trend" id="trend-doctors">+3% 20 days</span>
        </div>
        <div class="value" id="value-doctors">575</div>
        <div class="sparkline">
            <canvas id="sparkline-doctors"></canvas>
        </div>
    </div>
</div>

<div class="overview-grid">
    <div class="panel patient-visited-panel">
        <div class="panel-header">
            <div>
                <div class="panel-title">Patient Visited</div>
                <div class="panel-subtitle">Monthly visitors overview</div>
            </div>
            <div class="range-switcher" id="patient-visited-range">
                <button class="active" data-range="monthly">Monthly</button>
                <button data-range="weekly">Weekly</button>
                <button data-range="today">Today</button>
            </div>
        </div>
        <div class="line-chart">
            <canvas id="patient-visited-chart"></canvas>
        </div>
    </div>
    <div class="panel patient-bar-panel">
        <div class="panel-header">
            <div>
                <div class="panel-title">Patient</div>
                <div class="panel-subtitle">Last 7 days</div>
            </div>
            <select class="panel-select" id="patient-bar-select">
                <option value="7">Last 7 days</option>
                <option value="30">Last 30 days</option>
            </select>
        </div>
        <div class="bar-chart">
            <canvas id="patient-bar-chart"></canvas>
        </div>
    </div>
</div>

<div class="bottom-grid">
    <div class="panel appointments-panel">
        <div class="panel-header">
            <div>
                <div class="panel-title">Appointment</div>
                <div class="panel-subtitle">Last 7 days</div>
            </div>
            <select class="panel-select">
                <option>Last 7 days</option>
                <option>Last 30 days</option>
            </select>
        </div>
        <table class="appointments-table">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Gender</th>
                    <th>Date</th>
                    <th>Time</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>
                        <div class="doctor">
                            <div class="avatar">DM</div>
                            <div>
                                <div>David Miller</div>
                                <div class="panel-subtitle">General Checkup</div>
                            </div>
                        </div>
                    </td>
                    <td>Male</td>
                    <td>15 Feb 2022</td>
                    <td>10:00 AM</td>
                    <td class="table-actions">
                        <i class="fas fa-check-circle"></i>
                        <i class="fas fa-ellipsis-h"></i>
                    </td>
                </tr>
                <tr>
                    <td>
                        <div class="doctor">
                            <div class="avatar">SS</div>
                            <div>
                                <div>Sabrina Suba</div>
                                <div class="panel-subtitle">Dental Care</div>
                            </div>
                        </div>
                    </td>
                    <td>Female</td>
                    <td>16 Feb 2022</td>
                    <td>08:00 AM</td>
                    <td class="table-actions">
                        <i class="fas fa-check-circle"></i>
                        <i class="fas fa-ellipsis-h"></i>
                    </td>
                </tr>
                <tr>
                    <td>
                        <div class="doctor">
                            <div class="avatar">JJ</div>
                            <div>
                                <div>Junaid Jerib</div>
                                <div class="panel-subtitle">Cardiology</div>
                            </div>
                        </div>
                    </td>
                    <td>Male</td>
                    <td>18 Feb 2022</td>
                    <td>02:00 PM</td>
                    <td class="table-actions">
                        <i class="fas fa-check-circle"></i>
                        <i class="fas fa-ellipsis-h"></i>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>

    <div class="panel top-patient-panel">
        <div class="panel-header">
            <div>
                <div class="panel-title">Top Patient Visit</div>
                <div class="panel-subtitle">See worldwide patient sources</div>
            </div>
        </div>
        <div class="world-map">
            <div class="map-pin" style="top: 42%; left: 62%;">Dhaka</div>
            <div class="map-pin" style="top: 35%; left: 30%;">Lisbon</div>
            <div class="map-pin" style="top: 58%; left: 45%;">Lagos</div>
        </div>
        <div class="patient-list">
            <div class="patient-item">
                <div>
                    <div class="name">Dhaka</div>
                    <div class="location">Bangladesh</div>
                </div>
                <div class="count">1,236</div>
            </div>
            <div class="patient-item">
                <div>
                    <div class="name">London</div>
                    <div class="location">United Kingdom</div>
                </div>
                <div class="count">982</div>
            </div>
            <div class="patient-item">
                <div>
                    <div class="name">Lagos</div>
                    <div class="location">Nigeria</div>
                </div>
                <div class="count">864</div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Chart.js Configuration and Data
document.addEventListener('DOMContentLoaded', function () {
    
    // ==================== SPARKLINE CHARTS ====================
    
    // Common sparkline options
    const sparklineOptions = {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
            legend: { display: false },
            tooltip: { enabled: false }
        },
        scales: {
            x: { display: false },
            y: { display: false }
        },
        elements: {
            point: { radius: 0 },
            line: { tension: 0.4 }
        }
    };
    
    // Sparkline 1: Appointments (Blue)
    const sparkAppointment = new Chart(
        document.getElementById('sparkline-appointment'),
        {
            type: 'line',
            data: {
                labels: Array(12).fill(''),
                datasets: [{
                    data: [5890, 6120, 5450, 5320, 6780, 5890, 6450, 5120, 6890, 5980, 6450, 7365],
                    borderColor: '#2563eb',
                    backgroundColor: (context) => {
                        const ctx = context.chart.ctx;
                        const gradient = ctx.createLinearGradient(0, 0, 0, 60);
                        gradient.addColorStop(0, 'rgba(37, 99, 235, 0.35)');
                        gradient.addColorStop(1, 'rgba(37, 99, 235, 0)');
                        return gradient;
                    },
                    fill: true,
                    borderWidth: 2
                }]
            },
            options: sparklineOptions
        }
    );
    
    // Sparkline 2: Patients (Cyan)
    const sparkPatient = new Chart(
        document.getElementById('sparkline-patient'),
        {
            type: 'line',
            data: {
                labels: Array(12).fill(''),
                datasets: [{
                    data: [4920, 4780, 5120, 5040, 4680, 5210, 4890, 5340, 4890, 5450, 5320, 5656],
                    borderColor: '#06b6d4',
                    backgroundColor: (context) => {
                        const ctx = context.chart.ctx;
                        const gradient = ctx.createLinearGradient(0, 0, 0, 60);
                        gradient.addColorStop(0, 'rgba(6, 182, 212, 0.35)');
                        gradient.addColorStop(1, 'rgba(6, 182, 212, 0)');
                        return gradient;
                    },
                    fill: true,
                    borderWidth: 2
                }]
            },
            options: sparklineOptions
        }
    );
    
    // Sparkline 3: Vacancy (Red - Declining)
    const sparkVacancy = new Chart(
        document.getElementById('sparkline-vacancy'),
        {
            type: 'line',
            data: {
                labels: Array(12).fill(''),
                datasets: [{
                    data: [670, 668, 655, 660, 658, 645, 650, 640, 648, 638, 642, 636],
                    borderColor: '#ef4444',
                    backgroundColor: (context) => {
                        const ctx = context.chart.ctx;
                        const gradient = ctx.createLinearGradient(0, 0, 0, 60);
                        gradient.addColorStop(0, 'rgba(239, 68, 68, 0.35)');
                        gradient.addColorStop(1, 'rgba(239, 68, 68, 0)');
                        return gradient;
                    },
                    fill: true,
                    borderWidth: 2
                }]
            },
            options: sparklineOptions
        }
    );
    
    // Sparkline 4: Doctors (Indigo)
    const sparkDoctors = new Chart(
        document.getElementById('sparkline-doctors'),
        {
            type: 'line',
            data: {
                labels: Array(12).fill(''),
                datasets: [{
                    data: [558, 562, 560, 565, 559, 570, 568, 563, 572, 569, 574, 575],
                    borderColor: '#7c3aed',
                    backgroundColor: (context) => {
                        const ctx = context.chart.ctx;
                        const gradient = ctx.createLinearGradient(0, 0, 0, 60);
                        gradient.addColorStop(0, 'rgba(124, 58, 237, 0.35)');
                        gradient.addColorStop(1, 'rgba(124, 58, 237, 0)');
                        return gradient;
                    },
                    fill: true,
                    borderWidth: 2
                }]
            },
            options: sparklineOptions
        }
    );
    
    // ==================== PATIENT VISITED LINE CHART ====================
    
    const patientVisitedData = {
        monthly: {
            labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
            data: [420, 380, 550, 340, 620, 450, 720, 580, 780, 620, 680, 850]
        },
        weekly: {
            labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
            data: [120, 150, 180, 160, 210, 190, 170]
        },
        today: {
            labels: ['12AM', '3AM', '6AM', '9AM', '12PM', '3PM', '6PM', '9PM'],
            data: [5, 8, 12, 45, 78, 95, 62, 38]
        }
    };
    
    const patientVisitedChart = new Chart(
        document.getElementById('patient-visited-chart'),
        {
            type: 'line',
            data: {
                labels: patientVisitedData.monthly.labels,
                datasets: [{
                    label: 'Patients',
                    data: patientVisitedData.monthly.data,
                    borderColor: '#2563eb',
                    backgroundColor: (context) => {
                        const ctx = context.chart.ctx;
                        const gradient = ctx.createLinearGradient(0, 0, 0, 260);
                        gradient.addColorStop(0, 'rgba(37, 99, 235, 0.25)');
                        gradient.addColorStop(1, 'rgba(37, 99, 235, 0)');
                        return gradient;
                    },
                    fill: true,
                    borderWidth: 3,
                    tension: 0.4,
                    pointBackgroundColor: '#fff',
                    pointBorderColor: '#2563eb',
                    pointBorderWidth: 2,
                    pointRadius: 5,
                    pointHoverRadius: 7
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false },
                    tooltip: {
                        backgroundColor: 'rgba(255, 255, 255, 0.95)',
                        titleColor: '#1e293b',
                        bodyColor: '#2563eb',
                        borderColor: '#e2e8f0',
                        borderWidth: 1,
                        padding: 12,
                        displayColors: false,
                        callbacks: {
                            label: function(context) {
                                return context.parsed.y + ' Patients';
                            }
                        }
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        grid: {
                            color: '#f1f5f9',
                            drawBorder: false
                        },
                        ticks: {
                            color: '#94a3b8',
                            font: { size: 11 }
                        }
                    },
                    x: {
                        grid: {
                            display: false,
                            drawBorder: false
                        },
                        ticks: {
                            color: '#94a3b8',
                            font: { size: 11 }
                        }
                    }
                }
            }
        }
    );
    
    // Range switcher for Patient Visited chart
    document.querySelectorAll('#patient-visited-range button').forEach(button => {
        button.addEventListener('click', function() {
            // Update active state
            document.querySelectorAll('#patient-visited-range button').forEach(btn => {
                btn.classList.remove('active');
            });
            this.classList.add('active');
            
            // Update chart data
            const range = this.dataset.range;
            patientVisitedChart.data.labels = patientVisitedData[range].labels;
            patientVisitedChart.data.datasets[0].data = patientVisitedData[range].data;
            patientVisitedChart.update();
        });
    });
    
    // ==================== PATIENT BAR CHART ====================
    
    const patientBarData = {
        7: {
            labels: ['Sa', 'Su', 'Mo', 'Tu', 'We', 'Th', 'Fr'],
            data: [165, 240, 195, 270, 225, 195, 255]
        },
        30: {
            labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4'],
            data: [1450, 1680, 1520, 1890]
        }
    };
    
    const patientBarChart = new Chart(
        document.getElementById('patient-bar-chart'),
        {
            type: 'bar',
            data: {
                labels: patientBarData[7].labels,
                datasets: [{
                    label: 'Patients',
                    data: patientBarData[7].data,
                    backgroundColor: (context) => {
                        const ctx = context.chart.ctx;
                        const gradient = ctx.createLinearGradient(0, 0, 0, 200);
                        gradient.addColorStop(0, '#2563eb');
                        gradient.addColorStop(1, 'rgba(37, 99, 235, 0.5)');
                        return gradient;
                    },
                    borderRadius: 8,
                    borderSkipped: false
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false },
                    tooltip: {
                        backgroundColor: 'rgba(255, 255, 255, 0.95)',
                        titleColor: '#1e293b',
                        bodyColor: '#2563eb',
                        borderColor: '#e2e8f0',
                        borderWidth: 1,
                        padding: 12,
                        displayColors: false,
                        callbacks: {
                            label: function(context) {
                                return context.parsed.y + ' Patients';
                            }
                        }
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        grid: {
                            color: '#f1f5f9',
                            drawBorder: false
                        },
                        ticks: {
                            color: '#94a3b8',
                            font: { size: 11 }
                        }
                    },
                    x: {
                        grid: {
                            display: false,
                            drawBorder: false
                        },
                        ticks: {
                            color: '#94a3b8',
                            font: { size: 12, weight: '500' }
                        }
                    }
                }
            }
        }
    );
    
    // Select dropdown for Patient bar chart
    document.getElementById('patient-bar-select').addEventListener('change', function() {
        const days = this.value;
        const subtitle = this.value === '7' ? 'Last 7 days' : 'Last 30 days';
        
        // Update subtitle
        this.closest('.panel-header').querySelector('.panel-subtitle').textContent = subtitle;
        
        // Update chart data
        patientBarChart.data.labels = patientBarData[days].labels;
        patientBarChart.data.datasets[0].data = patientBarData[days].data;
        patientBarChart.update();
    });
    
    // ==================== ANIMATE STATS ON LOAD ====================
    
    function animateValue(id, start, end, duration) {
        const obj = document.getElementById(id);
        const range = end - start;
        const increment = range / (duration / 16);
        let current = start;
        
        const timer = setInterval(function() {
            current += increment;
            if ((increment > 0 && current >= end) || (increment < 0 && current <= end)) {
                current = end;
                clearInterval(timer);
            }
            obj.textContent = Math.floor(current).toLocaleString('en-US');
        }, 16);
    }
    
    // Animate stat values
    animateValue('value-appointment', 0, 7365, 1000);
    animateValue('value-patient', 0, 5656, 1000);
    animateValue('value-vacancy', 0, 636, 1000);
    animateValue('value-doctors', 0, 575, 1000);
    
    // ==================== REAL-TIME DATA SIMULATION ====================
    
    // Simulate real-time updates every 5 seconds
    setInterval(function() {
        // Update appointment sparkline with new data point
        const appointmentData = sparkAppointment.data.datasets[0].data;
        appointmentData.shift();
        appointmentData.push(appointmentData[appointmentData.length - 1] + Math.floor(Math.random() * 200 - 100));
        sparkAppointment.update();
        
        // Update patient sparkline
        const patientData = sparkPatient.data.datasets[0].data;
        patientData.shift();
        patientData.push(patientData[patientData.length - 1] + Math.floor(Math.random() * 150 - 75));
        sparkPatient.update();
    }, 5000);
});
</script>
{% endblock %}
