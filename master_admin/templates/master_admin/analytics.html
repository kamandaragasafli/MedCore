{% extends 'master_admin/base.html' %}

{% block title %}Platform Analitikası - Master Admin{% endblock %}

{% block content %}
<div class="page-header" style="margin-bottom: 30px;">
    <h1 style="color: var(--master-primary);">
        <i class="fas fa-chart-line"></i> Platform Analitikası
    </h1>
    <p style="color: #666;">Platform-wide İstatistikalar və Təhlillər</p>
</div>

<!-- Growth Stats -->
<div class="master-card" style="margin-bottom: 30px;">
    <h3 style="color: var(--master-primary); margin-bottom: 20px;">
        <i class="fas fa-chart-area"></i> Artım Statistikası
    </h3>
    
    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 30px;">
        <!-- Company Growth -->
        <div>
            <h4 style="margin-bottom: 15px; color: #1f2937;">
                <i class="fas fa-building"></i> Şirkət Artımı
            </h4>
            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px;">
                <div style="background: #f0fdf4; padding: 15px; border-radius: 8px; text-align: center;">
                    <div style="font-size: 24px; font-weight: bold; color: #22c55e;">
                        {{ companies_last_7 }}
                    </div>
                    <div style="font-size: 12px; color: #666; margin-top: 5px;">
                        Son 7 Gün
                    </div>
                </div>
                <div style="background: #ecfdf5; padding: 15px; border-radius: 8px; text-align: center;">
                    <div style="font-size: 24px; font-weight: bold; color: #22c55e;">
                        {{ companies_last_30 }}
                    </div>
                    <div style="font-size: 12px; color: #666; margin-top: 5px;">
                        Son 30 Gün
                    </div>
                </div>
                <div style="background: #d1fae5; padding: 15px; border-radius: 8px; text-align: center;">
                    <div style="font-size: 24px; font-weight: bold; color: #22c55e;">
                        {{ companies_last_90 }}
                    </div>
                    <div style="font-size: 12px; color: #666; margin-top: 5px;">
                        Son 90 Gün
                    </div>
                </div>
            </div>
        </div>
        
        <!-- User Growth -->
        <div>
            <h4 style="margin-bottom: 15px; color: #1f2937;">
                <i class="fas fa-users"></i> İstifadəçi Artımı
            </h4>
            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px;">
                <div style="background: #eff6ff; padding: 15px; border-radius: 8px; text-align: center;">
                    <div style="font-size: 24px; font-weight: bold; color: #3b82f6;">
                        {{ users_last_7 }}
                    </div>
                    <div style="font-size: 12px; color: #666; margin-top: 5px;">
                        Son 7 Gün
                    </div>
                </div>
                <div style="background: #dbeafe; padding: 15px; border-radius: 8px; text-align: center;">
                    <div style="font-size: 24px; font-weight: bold; color: #3b82f6;">
                        {{ users_last_30 }}
                    </div>
                    <div style="font-size: 12px; color: #666; margin-top: 5px;">
                        Son 30 Gün
                    </div>
                </div>
                <div style="background: #bfdbfe; padding: 15px; border-radius: 8px; text-align: center;">
                    <div style="font-size: 24px; font-weight: bold; color: #3b82f6;">
                        {{ users_last_90 }}
                    </div>
                    <div style="font-size: 12px; color: #666; margin-top: 5px;">
                        Son 90 Gün
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Status Distribution -->
<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px;">
    <!-- Company Status -->
    <div class="master-card">
        <h3 style="color: var(--master-primary); margin-bottom: 20px;">
            <i class="fas fa-chart-pie"></i> Şirkət Status Paylanması
        </h3>
        
        <canvas id="companyStatusChart" style="max-height: 300px;"></canvas>
        
        <div style="margin-top: 20px; display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px;">
            <div style="text-align: center; padding: 10px; background: #dcfce7; border-radius: 6px;">
                <div style="font-weight: bold; color: #15803d;">{{ active_count }}</div>
                <div style="font-size: 12px; color: #666;">Aktiv</div>
            </div>
            <div style="text-align: center; padding: 10px; background: #fee2e2; border-radius: 6px;">
                <div style="font-weight: bold; color: #991b1b;">{{ inactive_count }}</div>
                <div style="font-size: 12px; color: #666;">Deaktiv</div>
            </div>
        </div>
    </div>
    
    <!-- Subscription Distribution -->
    <div class="master-card">
        <h3 style="color: var(--master-primary); margin-bottom: 20px;">
            <i class="fas fa-box"></i> Abunəlik Paketi Paylanması
        </h3>
        
        <canvas id="subscriptionDistChart" style="max-height: 300px;"></canvas>
        
        <div style="margin-top: 20px;">
            {% for plan_name, count in subscription_distribution.items %}
            <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #e5e7eb;">
                <span style="font-size: 13px;">{{ plan_name }}</span>
                <span style="font-weight: bold; color: var(--master-primary);">{{ count }}</span>
            </div>
            {% endfor %}
        </div>
    </div>
</div>

<!-- Monthly Registrations -->
<div class="master-card">
    <h3 style="color: var(--master-primary); margin-bottom: 20px;">
        <i class="fas fa-calendar-alt"></i> Aylıq Qeydiyyat Trendi (Son 12 Ay)
    </h3>
    
    <canvas id="monthlyRegChart" style="max-height: 300px;"></canvas>
</div>

<!-- Back Button -->
<div style="margin-top: 30px; text-align: center;">
    <a href="{% url 'master_admin:dashboard' %}" class="btn-master" style="text-decoration: none;">
        <i class="fas fa-arrow-left"></i> Ana Səhifəyə Qayıt
    </a>
</div>

<script>
// Company Status Chart
const statusCtx = document.getElementById('companyStatusChart').getContext('2d');
new Chart(statusCtx, {
    type: 'doughnut',
    data: {
        labels: ['Aktiv', 'Deaktiv'],
        datasets: [{
            data: [{{ active_count }}, {{ inactive_count }}],
            backgroundColor: ['#22c55e', '#dc2626'],
            borderWidth: 0
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
            legend: {
                position: 'bottom'
            }
        }
    }
});

// Subscription Distribution Chart
const subCtx = document.getElementById('subscriptionDistChart').getContext('2d');
new Chart(subCtx, {
    type: 'bar',
    data: {
        labels: [{% for plan_name in subscription_distribution.keys %}'{{ plan_name }}'{% if not forloop.last %}, {% endif %}{% endfor %}],
        datasets: [{
            label: 'Abunəçi Sayı',
            data: [{% for count in subscription_distribution.values %}{{ count }}{% if not forloop.last %}, {% endif %}{% endfor %}],
            backgroundColor: '#3b82f6',
            borderRadius: 6
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
            legend: {
                display: false
            }
        },
        scales: {
            y: {
                beginAtZero: true,
                ticks: {
                    stepSize: 1
                }
            }
        }
    }
});

// Monthly Registration Chart
const monthlyCtx = document.getElementById('monthlyRegChart').getContext('2d');
new Chart(monthlyCtx, {
    type: 'line',
    data: {
        labels: [{% for item in monthly_registrations %}'{{ item.month }}'{% if not forloop.last %}, {% endif %}{% endfor %}],
        datasets: [{
            label: 'Yeni Qeydiyyatlar',
            data: [{% for item in monthly_registrations %}{{ item.count }}{% if not forloop.last %}, {% endif %}{% endfor %}],
            borderColor: '#dc2626',
            backgroundColor: 'rgba(220, 38, 38, 0.1)',
            fill: true,
            tension: 0.4
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
            legend: {
                display: false
            }
        },
        scales: {
            y: {
                beginAtZero: true,
                ticks: {
                    stepSize: 1
                }
            }
        }
    }
});
</script>
{% endblock %}

